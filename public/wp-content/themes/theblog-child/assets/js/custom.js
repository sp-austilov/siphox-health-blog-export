jQuery(document).ready(function () {




  // scrollbar js initialization
  jQuery(".nano").nanoScroller();

  // cloning menu items in mobile
  $mobileNav = jQuery('<div id="mobileNav"></div>').prependTo(
    ".offcanvas .nano .nano-content"
  );
  $mobileNav.append(jQuery(".header .mynav > ul").clone());

  // offcanvas toggle
  jQuery(".toggle a").click(function (e) {
    jQuery(".offcanvas").addClass("show-offcanvas");
    jQuery("body").addClass("pushed");
    jQuery(".body-inactive").fadeIn(350);
    e.preventDefault();
  });


  // closing ups clicking on the screen
  jQuery(".body-inactive, .coff a.c-close").click(function (e) {
    jQuery(".offcanvas").removeClass("show-offcanvas");
    jQuery("body").removeClass("pushed");
    jQuery(".body-inactive").fadeOut(150);
    e.preventDefault();
  });

  // DropDown Handlings
  jQuery("#mobileNav > ul > li > a").click(function (e) {
    findIfNotEmptyHref = jQuery(this).attr("href");
    findIfHasChildren = jQuery(this).parent().find("ul");

    if (findIfHasChildren.length > 0 && findIfNotEmptyHref === "#") {
      console.log("dfaf");
      e.preventDefault();
      findSubMenuDisplay = jQuery(this).parent().find("ul").css("display");
      if (findSubMenuDisplay == "block") {
        jQuery(this).parent().find("ul").slideUp(350);
      } else {
        jQuery("#mobileNav ul li ul").slideUp(350);
        jQuery(this).parent().find("ul").slideDown(350);
      }
    }
  });


  // Making Table Responsive
  jQuery(".bc-detail table").each(function () {
    jQuery(this).wrap("<div class='table-responsive'></div>").addClass("table");
  });

  // Sticky TOC - Table of Contents
  jQuery(".sticky-with-state-toc").sticky({
    topSpacing: 100,
    bottomSpacing: 700,
  });

  // Single Page Blockquote
  let blockQuoteObject = jQuery(".bc-detail .entry-content blockquote");
  let countPre;
  blockQuoteObject.each(function () {
    jQuery(this).wrapAll('<div class="blockquote-wrapper"></div>');
    countPre = jQuery(this).children("h6").length;
    if (countPre > 0) {
      jQuery(this).addClass("is-attributed");
    }
  });
});

// Blog Home Button Active Anims

  let xPadding = parseInt(
    jQuery(".categories-filter li a").css("padding-left")
  );
 if (jQuery(".categories-filter").length > 0) {
   let buttonInitialWidth =
     jQuery(".categories-filter li a.active").width() + 2 * xPadding;
   let animInitalOffset = jQuery(".categories-filter ul > span").position()
     .left;
   jQuery(".categories-filter ul > span").css({
     width: buttonInitialWidth,
     left: animInitalOffset,
     top:-5.5
   });
 }

jQuery(".categories-filter a").on("click", function () {
  jQuery(".categories-filter ul > span").css({
    transform: "translate(" + jQuery(this).position().left + "px ," + (jQuery(this).position().top) + "px" + ")",
    width: jQuery(this).width() + 2 * xPadding,
  });
});

// let active = [];
// Sticky Active State for TOC - Table of Contents
// window.addEventListener("DOMContentLoaded", () => {
//   const observer = new IntersectionObserver(
//     (entries) => {
//       entries.forEach((entry) => {
//         const id = entry.target.getAttribute("id");
//         if (entry.intersectionRatio > 0 && !id.includes("footnote_plugin")) {
//           active.push(id);
//           // document.querySelector(`.single .sticky-with-state-toc a[href="#${id}"]`).parentElement.classList.add('toc-active');
//         } else {
//           if (active.indexOf(id) !== -1) {
//             active.splice(active.indexOf(id), 1);
//           }
//           document
//             .querySelector(`.single .sticky-with-state-toc li a[href="#${id}"]`)
//             .parentElement.classList.remove("toc-active");
//         }
//       });
//     },
//     { rootMargin: "-100px 0px -300px 0px" }
//   );

//   // Track all titles that have an `id` applied - generated by TOC
//   document.querySelectorAll("span[id]").forEach((section) => {
//     observer.observe(section);
//   });
// });

// window.addEventListener("scroll", () => {
//   if (active.length > 0)
//     document
//       .querySelector(`.single .sticky-with-state-toc a[href="#${active?.[0]}"]`)
//       .parentElement.classList.add("toc-active");
//   // active.map((id, index) => {
//   //   if (index !== 0) {
//   //     document
//   //       .querySelector(`.single .sticky-with-state-toc li a[href="#${id}"]`)
//   //       .parentElement.classList.remove("toc-active")
//   //   }
//   // })
// });

const anchors = jQuery("body").find("span[id]");

window.addEventListener("scroll", () => {
  var scrollTop = jQuery(document).scrollTop();

  // highlight the last scrolled-to: set everything inactive first
  for (var i = 0; i < anchors.length; i++) {
    document
      .querySelector(
        '.single .sticky-with-state-toc li a[href="#' +
          jQuery(anchors[i]).attr("id") +
          '"]'
      )
      ?.parentElement?.classList?.remove("toc-active");
  }

  // then iterate backwards, on the first match highlight it and break
  for (var i = anchors.length - 1; i >= 0; i--) {
    if (scrollTop > jQuery(anchors[i]).offset().top - 200) {
      document
        .querySelector(
          '.single .sticky-with-state-toc li a[href="#' +
            jQuery(anchors[i]).attr("id") +
            '"]'
        )
        ?.parentElement?.classList.add("toc-active");
      break;
    }
  }

  // Content Highlighter
  let lengthOfMark;
  jQuery(".bd-content-body p").each(function(){
    lengthOfMark = jQuery(this).find("mark").length
    if(lengthOfMark>0){
      jQuery(this).addClass("highlighter___box");
    }
  })

 

});

function onChange(e){
  jQuery(e.target).parent().removeClass("error")
  jQuery(e.target).parent().find("button").attr("disabled", false)
}

function newsletterSubmit(e){
  e.preventDefault();
  var nLetter = jQuery(e.target)
  var btn = jQuery(e.target).find("button")
  var email = jQuery(e.target).find("input").val()
  var headers = {
    "Content-Type": "application/json",
  }
    var urls = "https://connect.siphoxhealth.com/user/invitation";
    btn.text("...");
    btn.attr("disabled", "true"); fetch(urls, {
    method: "POST",
    body: JSON.stringify({ email, source: "blog", first_name: email.split('@')[0], last_name: email.split('@')[0] }),
    headers: headers,
  }).then(function(res){
    if(res.status === 200){
      nLetter.parent().find("h3").text("Thank you!")
      nLetter.parent().parent().find("h2").text("Thank you!")
      nLetter.parent().find("p").removeClass("mb-28px").addClass("mb-0").text("Signed up successfully")
      nLetter.parent().parent().find("p").removeClass("mb-48px").addClass("mb-0").text("Signed up successfully")
      nLetter.removeClass("d-flex").addClass("d-none")
      return
    }
    nLetter.addClass("error")
  }).catch(function(err){
    nLetter.addClass("error")
  }).finally(function(){
    btn.attr("disabled", "false")
    btn.text("Sign Up")

  })
}
